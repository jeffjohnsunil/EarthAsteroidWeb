<!DOCTYPE html>
<html>
    <head>
        <title>Earth Asteroid Web</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="An informative website about space debris">
        <meta name="title" content="The Earth Asteroid Web">
        <meta name="subject" content="asteroids, earth, earth asteroid web, space debris, solutions">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/cover/">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        
        <script src=
        "https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
          <script
            src=
        "https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"
            type="text/javascript"
          ></script>
          <script src=
        "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
          <script src=
        "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.2/Chart.min.js"></script>
    <style>
        @font-face {
            font-family: "aquireLight";
            src: url("nasa21-font/Nasa21-l23X.ttf");
        }

        body {
            font-family: "aquireLight";
        }

        .tag {
            opacity: 0;
            transform: translate(0, 10vh);
            transition: all 1s;
        }

        .tag.visible {
            opacity: 1;
            transform: translate(0, 0);
        }

        .parallax {
            background-image: url("https://images.newscientist.com/wp-content/uploads/2021/08/20165006/PRI_195542462.jpg");
            min-height: 500px;
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }

        .earth * {
            transition: all 4s cubic-bezier(0,1.5,.3,1);
        }

        .earth img {
            height: 200px;
            width: 200px;
            border-radius: 50%;
        }

        .earth .more-info {
            background-image: linear-gradient(to bottom, rgba(10,10,10,1), black);
            text-align: left;
            border-radius: 1em;
            position: absolute;
            left: 45%;
            color: #fff;
            opacity: 0;
            padding: 1em;
            transform-origin: 0 0;
            transform: scale(.8);
            width: 50%;
            z-index: 12;
        }

        .earth .more-info h1 {
            margin: 0 0 1em;
            text-align: right;
        }

        .earth:hover img { transform: translateX(-75px) translateY(-75px) scale(.5); }
        .earth:hover .more-info { opacity: 1; transform: none; }

        .info {
            position: absolute; 
            background-color: white; 
            margin-top: 50px; 
            margin-left: 50px; 
            padding: 5px;
        }

        @media (max-width: 800px) {
            .earth img {
                height: 200px;
                width: 200px;
                border-radius: 50%;
            }
            
            .earth .more-info {
                background-image: linear-gradient(to bottom, rgba(10,10,10,1), black);
                text-align: left;
                border-radius: 1em;
                position: absolute;
                left: 12%;
                color: #fff;
                opacity: 0;
                padding: 1em;
                transform-origin: 0 0;
                transform: scale(.8);
                width: 75%;
            }

            .info {
                visibility: hidden;
                background-color: white; 
                padding: 5px;
            }
        }

        .fix{
            position:fixed;
            bottom: 0px;
            left: 42%;
            height: 200px;
        }

        .invisible {
            visibility: hidden;
            height: 0px;
        }

        .intro-text{
            text-align: center;
            font-size: 3em;
            width: 0ch;
            overflow: hidden;
            margin: 0 auto;
            white-space: nowrap;
            background-clip: text;
            background-image: linear-gradient(155deg, #fb7419, #bc1429, #319197);
            -webkit-background-clip: text;
            color: transparent;
        }
        .intro-text.active{
            animation: typeIn 1s steps(28) forwards;
        }
        @keyframes typeIn {
            to { width: 6.5ch; }
        }
        .sticky {
            position: -webkit-sticky;
            position: sticky;
            top: 100px;
            font-size: 20px;
        }

        #controlsInfo {
            position: absolute;
            padding: 10px;
            z-index: 9;
            background-color: #f1f1f1;
            border: 1px solid #d3d3d3;
            text-align: center;
            width: 30%;
        }

        #controlsInfoHeader {
            padding: 10px;
            cursor: move;
            z-index: 10;
            background-color: #2196F3;
            color: #fff;
        }

        @media (max-width: 800px) {
            #controlsInfo {
                visibility: hidden;
            }
            #controlsInfoHeader {
                visibility: hidden;
            }
        }
    </style></head>
    <body class="text-center">
        <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
            <a class="navbar-brand" href="#">Earth Asteroid Web</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-item nav-link" href="index.html">Home</a>
                    <a class="nav-item nav-link active" href="info.html">Info <span class="sr-only">(current)</span></a>
                    <a class="nav-item nav-link" href="calculator.html">Calculator</a>
                </div>
            </div>
        </nav>
        <div class="p-5 flex-column", style="background-image: url('https://images.newscientist.com/wp-content/uploads/2021/08/20165006/PRI_195542462.jpg'); height: 100%">
            <div class="jumbotron jumbotron-fluid">
                <div class="container">
                    <h1 class="intro-text">Dealing</h1>
                    <h1 class="intro-text">with</h1>
                    <h1 class="intro-text">orbital</h1>
                    <h1 class="intro-text">debris</h1><br>
                    <p class="lead">Get ready. It's time to science.</p>
                </div>
            </div>
        </div>
        <br>
        <div class="container">
            <div class="row">
                <div class="col align-self-center">
                    <h1>Important key terms</h1>
                    <p>Before we get into the nitty-gritty details of classifications, we need to define some important key terms. These will 
                        come in handy soon.
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col align-self-start" style="text-align: left;">
                    <ul>
                        <li><b>Aphelion:</b> The point of orbit at which an asteroid is furthest from the Earth.</li>
                        <li><b>Perihelion:</b> The point of orbit at which an asteroid is closest to the Earth.</li>
                        <li><b>Semi-major axis:</b> The length of the longest radius of an ellipse, that is the greatest 
                            distance between the centre of the ellipse and the perimeter of the ellipse.</li>
                        <li><b>Astronomical Unit (au):</b> A unit of length, roughly the distance from Earth to the Sun and 
                            equal to about 150 million kilometres</li>
                    </ul>
                </div>
            </div>
        </div><br><br>
        <div class="row" style="background-color: #000; width: 101%;">
            <div class="col-sm-6">
                <div class="earth" style="background-color: #000">
                    <br><div class="more-info">
                        <h1>Amors</h1>
                        <ul>
                          <li>Orbits are larger than Earth's but smaller than Mars's.</li>
                          <li>The semi-major axis is greater than 1 au.</li>
                          <li>The perihelion is between 1.017 au and 1.3 au.</li>
                        </ul>
                    </div>
                    <img src="Amors.png"><br><br><br><br><br>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="earth" style="background-color: #000">
                    <br><div class="more-info">
                        <h1>Apollos</h1>
                        <ul>
                          <li>Orbits cross the Earth's but the semi-major axes are bigger.</li>
                          <li>The semi-major axis is greater than 1 au.</li>
                          <li>The perihelion is less than 1.017 au.</li>
                        </ul>
                    </div>
                    <img src="Apollos.png"><br><br><br><br><br>
                </div>
            </div>
        </div>
        <div class="row" style="background-color: #000; width: 101%;">
            <div class="col-sm-6">        
                <div class="earth" style="background-color: #000">
                    <br><div class="more-info">
                        <h1>Atens</h1>
                        <ul>
                        <li>Orbits cross the Earth's but the semi-major axes are smaller.</li>
                        <li>The semi-major axis is less than 1 au.</li>
                        <li>The aphelion is greater than 0.983 au.</li>
                        </ul>
                    </div>
                    <img src="Atens.png"><br><br><br><br><br>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="earth" style="background-color: #000">
                    <br><div class="more-info">
                        <h1>Atiras</h1>
                        <ul>
                          <li>Orbits are entirely contained in the Earth's.</li>
                          <li>The semi-major axis is less than 1 au.</li>
                          <li>The aphelion is less than 0.983 au.</li>
                        </ul>
                    </div>
                    <img src="Atiras.png"><br><br><br><br><br>
                </div>
            </div>
            <div class='alertTrigger'></div>
        </div>
        <div id="container"></div>
        <div id="controlsInfo">
            <div id="controlsInfoHeader">Click here to move</div>
            <p>This is a simulation to help you visualize how many asteroids there are. Blue objects represent parts of rocket bodies.
                Yellow objects represent payload (waste ejected from rockets). Grey objects represent general debris and green ones represent
                others. Check the box if you want to trigger viweing orbits.</p>
            <input type="checkbox" id="orbitCheck"> View orbits
        </div>
        <script src="js/three.js"></script>
    </body>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.7.1/dist/Chart.min.js"></script>
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
    <script>
      feather.replace()
    </script>
    <script>
        var alertTriggerActive = true
        $(document).on("scroll", function() {
            var pageTop = $(document).scrollTop();
            var pageBottom = pageTop + $(window).height();
            var tags = $(".tag");
            var alertTriggerers = $(".alertTrigger")

            for (var i = 0; i < tags.length; i++) {
                var tag = tags[i];

                if ($(tag).position().top < pageBottom) {
                    $(tag).addClass("visible");
                } else {
                    $(tag).removeClass("visible");
                }
            }

            for (var i = 0; i < alertTriggerers.length; i++) {
                var alertTrigger = alertTriggerers[i];

                if ($(alertTrigger).position().top < pageBottom & alertTriggerActive) {
                    alert('Click each asteroid to learn more.');
                    alertTriggerActive = false
                }
            }
        });

        window.onscroll = function() {
            var asteroids = document.getElementsByClassName('frozen-element');
            var locations = document.getElementsByClassName('location');
            var pageTop = $(document).scrollTop();
            var pageBottom = pageTop + $(window).height();
            for (var i = 0; i < asteroids.length; i++) {
                var location = locations[i]
                var asteroid = asteroids[i]
                if ( $(location).position().top < pageBottom & pageTop > $(location).position().top) {
                    $(asteroid).addClass("sticky");
                } else {
                    $(asteroid).removeClass("sticky");
                }
            }
        }
    </script>
    <script>
        function scrollTrigger(selector, options = {}){
            let els = document.querySelectorAll(selector)
            els = Array.from(els)
            els.forEach(el => {
                addObserver(el, options)
            })
        }
        function addObserver(el, options){
            if(!('IntersectionObserver' in window)){
                if(options.cb){
                    options.cb(el)
                }else{
                    entry.target.classList.add('active')
                }
                return
            }
            let observer = new IntersectionObserver((entries, observer) => { //this takes a callback function which receives two arguments: the elemts list and the observer instance
                entries.forEach(entry => {
                    if(entry.isIntersecting){
                        if(options.cb){
                            options.cb(el)
                        }else{
                            entry.target.classList.add('active')
                        }
                        observer.unobserve(entry.target)
                    }
                })
            }, options)
            observer.observe(el)
        }
        scrollTrigger('.intro-text')
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/xlsx.full.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/jszip.js"></script>
    <script type="module">
        import { OrbitControls } from 'https://cdn.skypack.dev/three@0.132.2/examples/jsm/controls/OrbitControls.js';
        function UploadProcess() {
            //fetch("https://api.apispreadsheets.com/data/aqc00bPoFhAFF5GN/").then(res=>{
            fetch("https://www.earthasteroidweb.live/starlink-track.json").then(res=>{
                if (res.status === 200){
                    // SUCCESS
                    res.json().then(data=>{
                        console.log(data)
                        GetTableFromExcel(data)
                    }).catch(err => console.log(err))
                }
                else{
                    // ERROR
                }
            })
        }
        function GetTableFromExcel(data) {
            class WebGL {
                static isWebGLAvailable() {
                    try {
                        const canvas = document.createElement( 'canvas' );
                        return !! ( window.WebGLRenderingContext && ( canvas.getContext( 'webgl' ) || canvas.getContext( 'experimental-webgl' ) ) );
                    } catch ( e ) {
                        return false;
                    }
                }

                static isWebGL2Available() {
                    try {
                        const canvas = document.createElement( 'canvas' );
                        return !! ( window.WebGL2RenderingContext && canvas.getContext( 'webgl2' ) );
                    } catch ( e ) {
                        return false;
                    }
                }

                static getWebGLErrorMessage() {
                    return this.getErrorMessage( 1 );
                }

                static getWebGL2ErrorMessage() {
                    return this.getErrorMessage( 2 );
                }

                static getErrorMessage( version ) {
                    const names = {
                        1: 'WebGL',
                        2: 'WebGL 2'
                    };
                    const contexts = {
                        1: window.WebGLRenderingContext,
                        2: window.WebGL2RenderingContext
                    };
                    let message = 'Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>';
                    const element = document.createElement( 'div' );
                    element.id = 'webglmessage';
                    element.style.fontFamily = 'monospace';
                    element.style.fontSize = '13px';
                    element.style.fontWeight = 'normal';
                    element.style.textAlign = 'center';
                    element.style.background = '#fff';
                    element.style.color = '#000';
                    element.style.padding = '1.5em';
                    element.style.width = '400px';
                    element.style.margin = '5em auto 0';

                    if ( contexts[ version ] ) {
                        message = message.replace( '$0', 'graphics card' );
                    } else {
                        message = message.replace( '$0', 'browser' );
                    }
                    message = message.replace( '$1', names[ version ] );
                    element.innerHTML = message;
                    return element;
                }
            }
            var excelRows = data
            //var excelRows = data['data']
            let camera, scene, renderer;
            let geometry, material, mesh;
            const orbitGroup = new THREE.Group()
            scene = new THREE.Scene();
            if ( WebGL.isWebGLAvailable() ) {
                init();
                animate();
            } else {
                const warning = WebGL.getWebGLErrorMessage();
                document.getElementById( 'container' ).appendChild( warning );
            }

            function init() {
                renderer = new THREE.WebGLRenderer( { antialias: true } );
                renderer.setPixelRatio( window.devicePixelRatio );
                renderer.setSize( window.innerWidth, window.innerHeight );
                document.body.appendChild( renderer.domElement );

                scene.background = new THREE.Color( 0xcccccc );

                camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 1000 );
                camera.far = 100000;
                camera.updateProjectionMatrix();
                
                const controls = new OrbitControls( camera, renderer.domElement );
                
                camera.position.set( 200, 0, 0 );
                controls.update();
                controls.minDistance = 150;
                controls.maxDistance = 2500;

                for ( let i = 0; i < excelRows.length; i ++ ) {
                    console.log(excelRows[i].COUNTRY)
                    const curve = new THREE.EllipseCurve(
                        0,  0,
                        (excelRows[i].SEMI_MINOR_AXIS + 6378) / 100, (excelRows[i].SEMI_MAJOR_AXIS + 6378) / 100,
                        0,  2 * Math.PI,
                        false,
                        0
                    );
                    
                    var colorP = 0
                    if(excelRows[i].OBJECT_TYPE == "PAYLOAD") {
                        colorP = 0xeded13
                    } else if (excelRows[i].OBJECT_TYPE == "DEBRIS") {
                        colorP = 0x5f4e43
                    } else if (excelRows[i].OBJECT_TYPE == "ROCKET BODY") {
                        colorP = 0x0d1bf0
                    } else {
                        colorP = 0x0df01e
                    }

                    const points = curve.getPoints( 1000 );
                    const geometry = new THREE.BufferGeometry().setFromPoints( points );
                    const material = new THREE.LineBasicMaterial( { color: colorP } );
                    const mesh = new THREE.Line( geometry, material );

                    var launchDate = excelRows[i].LAUNCH
                    var launchDateMillisec = parseInt(launchDate.slice(0, 4)) * 31536000000 + parseInt(launchDate.slice(5, 7)) * 31536000000 / 12 + parseInt(launchDate.slice(8)) * 31536000000 / 365
                    var minutesDone = (Date.now() - launchDateMillisec) / 60000
                    var periodsDone = minutesDone / excelRows[i].PERIOD
                    var currentPeriod = periodsDone - Math.floor(periodsDone)

                    const asteroidPos = new THREE.Vector2 (points[Math.round(currentPeriod * 1000)].x, points[Math.round(currentPeriod * 1000)].y)

                    const geometryP = new THREE.SphereGeometry (3, 10, 100);
                    const materialP = new THREE.MeshBasicMaterial( { color: colorP } );     
                    const meshP = new THREE.Mesh(geometryP, materialP);
                    meshP.position.set ( asteroidPos.width, asteroidPos.height, 0 );

                    const groupP = new THREE.Group();
                    groupP.add(mesh);
                    groupP.add(meshP);
                    groupP.rotateX(Math.PI / 2 - (excelRows[i].INCLINATION * Math.PI / 180))
                    scene.add(groupP)

                    mesh.rotateX(Math.PI / 2 - (excelRows[i].INCLINATION * Math.PI / 180))
                    orbitGroup.add(mesh)
                }
                const geometry2 = new THREE.SphereGeometry (3000, 10, 100);
                const material2 = new THREE.MeshBasicMaterial( {
                    map: new THREE.TextureLoader().load(
                        'https://s3-us-west-2.amazonaws.com/s.cdpn.io/123941/star-field.png'
                    ),
                    side: THREE.BackSide
                });
                material2.side = THREE.BackSide;
                            
                const mesh2 = new THREE.Mesh(geometry2, material2);
                scene.add(mesh2);

                const geometry1 = new THREE.SphereGeometry( 63.71, 32, 16 );
                const material1 = new THREE.MeshBasicMaterial( {
                    map: new THREE.TextureLoader().load(
                        'https://raw.githubusercontent.com/BHouwens/SolarSim/master/images/earthmap1k.jpg'
                    )
                } );

                const mesh1 = new THREE.Mesh( geometry1, material1 );
                scene.add( mesh1 );

                const ambientLight = new THREE.AmbientLight( 0x222222 );
                scene.add( ambientLight );

                document.querySelector('#orbitCheck').addEventListener('change', (event) =>{
                    onOrbitCheck()
                })
            }

            function animate() {
                requestAnimationFrame( animate );
                renderer.render( scene, camera );
            }
            
            var triggered = true
            function onOrbitCheck( ) {
                if (triggered == true) {
                    scene.add(orbitGroup)
                    triggered = false
                } else {
                    scene.remove(orbitGroup)
                    triggered = true
                }
            }
        };
        $(document).ready(function () {  
            UploadProcess()
        });
    </script>
    <script>
        dragElement(document.getElementById("controlsInfo"));
        function dragElement(elmnt) {
            var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            if (document.getElementById(elmnt.id + "Header")) {
                // if present, the header is where you move the DIV from:
                document.getElementById(elmnt.id + "Header").onmousedown = dragMouseDown;
            } else {
                // otherwise, move the DIV from anywhere inside the DIV:
                elmnt.onmousedown = dragMouseDown;
            }

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                // get the mouse cursor position at startup:
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                // call a function whenever the cursor moves:
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // calculate the new cursor position:
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // set the element's new position:
                elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                // stop moving when mouse button is released:
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

    </script>
</html>